{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","_http","negociacao","getConnection","then","connection","dao","adiciona","catch","Error","listarTodos","console","log","erro","apagar","listaAtual","obterNegociacoes","negociacoes","filter","some","isEquals","outra","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","reduce","arrayAchatado","array","concat","resolve","reject","get","map","Date","objeto","data","quantidade","valor"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import { HttpService } from \"./HttpService\";\nimport { ConnectionFactory } from \"./ConnectionFactory\";\nimport { NegociacaoDao } from \"../dao/NegociacaoDao\";\nimport { Negociacao } from \"../models/Negociacao\";\n\nexport class NegociacaoService {\n  constructor() {\n    this._http = new HttpService();\n  }\n\n  cadastrar(negociacao) {\n    return ConnectionFactory.getConnection()\n      .then(connection => new NegociacaoDao(connection))\n      .then(dao => dao.adiciona(negociacao))\n      .then(() => \"Negociação adicionada com sucesso\")\n      .catch(() => {\n        throw new Error(\"Não foi possível adicionar a negociação\");\n      });\n  }\n\n  listar() {\n    return ConnectionFactory.getConnection()\n      .then(connection => new NegociacaoDao(connection))\n      .then(dao => dao.listarTodos())\n      .catch(erro => {\n        console.log(erro);\n        throw new Error(\"Não foi possível listar as negociações\");\n      });\n  }\n\n  apagar() {\n    return ConnectionFactory.getConnection()\n      .then(connection => new NegociacaoDao(connection))\n      .then(dao => dao.apagar())\n      .then(() => \"Negociações apagadas com sucesso\")\n      .catch(erro => {\n        console.log(erro);\n        throw new Error(\"Não foi possível apagar as negociações\");\n      });\n  }\n\n  importa(listaAtual) {\n    return this.obterNegociacoes()\n      .then(negociacoes =>\n        negociacoes.filter(\n          negociacao => !listaAtual.some(outra => negociacao.isEquals(outra))\n        )\n      )\n      .catch(erro => {\n        console.log(erro);\n        throw new Error(\"Não foi possível buscar as negociações para importar\");\n      });\n  }\n\n  obterNegociacoes() {\n    return Promise.all([\n      this.obterNegociacoesDaSemana(),\n      this.obterNegociacoesDaSemanaAnterior(),\n      this.obterNegociacoesDaSemanaRetrasada()\n    ])\n      .then(negociacoes => {\n        return negociacoes.reduce(\n          (arrayAchatado, array) => arrayAchatado.concat(array),\n          []\n        );\n      })\n      .catch(erro => {\n        throw new Error(erro);\n      });\n  }\n\n  obterNegociacoesDaSemana() {\n    return new Promise((resolve, reject) => {\n      this._http\n        .get(\"negociacoes/semana\")\n        .then(negociacoes => {\n          resolve(\n            negociacoes.map(\n              objeto =>\n                new Negociacao(\n                  new Date(objeto.data),\n                  objeto.quantidade,\n                  objeto.valor\n                )\n            )\n          );\n        })\n        .catch(erro => {\n          console.log(erro);\n          reject(erro);\n        });\n    });\n  }\n\n  obterNegociacoesDaSemanaRetrasada() {\n    return new Promise((resolve, reject) => {\n      this._http\n        .get(\"negociacoes/retrasada\")\n        .then(negociacoes => {\n          resolve(\n            negociacoes.map(\n              objeto =>\n                new Negociacao(\n                  new Date(objeto.data),\n                  objeto.quantidade,\n                  objeto.valor\n                )\n            )\n          );\n        })\n        .catch(erro => {\n          console.log(erro);\n          reject(erro);\n        });\n    });\n  }\n\n  obterNegociacoesDaSemanaAnterior() {\n    return new Promise((resolve, reject) => {\n      this._http\n        .get(\"negociacoes/anterior\")\n        .then(negociacoes => {\n          resolve(\n            negociacoes.map(\n              objeto =>\n                new Negociacao(\n                  new Date(objeto.data),\n                  objeto.quantidade,\n                  objeto.valor\n                )\n            )\n          );\n        })\n        .catch(erro => {\n          console.log(erro);\n          reject(erro);\n        });\n    });\n  }\n}\n"]}